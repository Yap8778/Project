<div class="diary-container">
  <div class="header">
    <h1>Daily Diary Entries</h1> <!-- // Main header for the diary page -->
    <p>Record your thoughts, feelings, and experiences</p> <!-- // Subheading describing the page's purpose -->
  </div>

  <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div> <!-- // Display error message if there is one -->

  <div class="actions">
    <button mat-raised-button color="primary" (click)="showCreateForm = !showCreateForm">
      <mat-icon>edit</mat-icon>
      {{ showCreateForm ? 'Cancel' : 'Write New Entry' }}
    </button>

    <div class="filter-section">
      <label>Filter by Emotion:</label>
      <select [(ngModel)]="selectedFilter" (change)="filterDiaries()">
        <option value="">All Entries</option>
        <option *ngFor="let emotion of emotions" [value]="emotion">
          {{ emotion }}
        </option>
      </select>
    </div>
  </div>

  <div class="emotion-buttons" *ngIf="!showCreateForm && !editingDiary">
    <button
      mat-stroked-button
      *ngFor="let emotion of emotions"
      [color]="selectedFilter === emotion ? 'primary' : ''"
      (click)="selectedFilter = emotion; filterDiaries()">
      <fa-icon [icon]="getEmotionIcon(emotion)"></fa-icon>
      {{ emotion }}
    </button>
  </div>

  <form *ngIf="showCreateForm" class="diary-form"> <!-- // Show form for creating a new diary entry -->
    <div class="form-group">
      <label for="title">Title:</label>
      <input type="text" id="title" [(ngModel)]="newDiary.title" name="title" required> <!-- // Title input field -->
    </div>

    <div class="form-group">
      <label for="content">Content:</label>
      <textarea id="content" [(ngModel)]="newDiary.content" name="content" rows="4" required></textarea> <!-- // Content textarea -->
    </div>

    <div class="form-group">
      <label for="emotion">Emotion:</label>
      <select id="emotion" [(ngModel)]="newDiary.emotion" name="emotion" required> <!-- // Emotion selection dropdown -->
        <option value="">Select an emotion</option> <!-- // Default option for emotion -->
        <option *ngFor="let emotion of emotions" [value]="emotion"> <!-- // Loop through emotions to create options -->
          <fa-icon [icon]="getEmotionIcon(emotion)"></fa-icon> <!-- // Emotion icon inside the option -->
          {{ emotion }} <!-- // Emotion name -->
        </option>
      </select>
    </div>

    <button mat-raised-button color="primary" type="submit" (click)="addDiary()">
      <mat-icon>save</mat-icon>
      Save Entry
    </button>
  </form>

  <form *ngIf="editingDiary" class="diary-form"> <!-- // Show form for editing an existing diary entry -->
    <div class="form-group">
      <label for="editTitle">Title:</label>
      <input type="text" id="editTitle" [(ngModel)]="editingDiary.title" name="editTitle" required> <!-- // Title input for editing -->
    </div>

    <div class="form-group">
      <label for="editContent">Content:</label>
      <textarea id="editContent" [(ngModel)]="editingDiary.content" name="editContent" rows="4" required></textarea> <!-- // Content textarea for editing -->
    </div>

    <div class="form-group">
      <label for="editEmotion">Emotion:</label>
      <select id="editEmotion" [(ngModel)]="editingDiary.emotion" name="editEmotion" required> <!-- // Emotion selection for editing -->
        <option *ngFor="let emotion of emotions" [value]="emotion"> <!-- // Loop through emotions to create options -->
          <fa-icon [icon]="getEmotionIcon(emotion)"></fa-icon> <!-- // Emotion icon -->
          {{ emotion }} <!-- // Emotion name -->
        </option>
      </select>
    </div>

    <div class="form-actions">
      <button mat-raised-button color="primary" type="button" (click)="saveEdit()">
        <mat-icon>save</mat-icon>
        Save Changes
      </button>
      <button mat-stroked-button color="warn" type="button" (click)="cancelEdit()">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </div>
  </form>

  <div class="diary-list" *ngIf="filteredDiaries.length > 0"> <!-- // Display list of diaries if any entries exist -->
    <div class="diary-item" *ngFor="let diary of filteredDiaries"> <!-- // Loop through filtered diaries -->
      <div class="diary-header">
        <h3 class="diary-title">{{ diary.title }}</h3> <!-- // Display the title of the diary -->
        <span class="diary-date">{{ diary.date | date:'medium' }}</span> <!-- // Display the date of the diary entry -->
      </div>

      <span class="diary-emotion {{ diary.emotion }}"> <!-- // Emotion tag for the diary entry -->
        <fa-icon [icon]="getEmotionIcon(diary.emotion)"></fa-icon> <!-- // Emotion icon -->
        {{ diary.emotion }} <!-- // Emotion name -->
      </span>

      <div class="diary-content">
        {{ diary.content }} <!-- // Display the content of the diary -->
      </div>

      <div class="diary-actions">
        <button mat-stroked-button color="primary" (click)="startEdit(diary)">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-stroked-button color="warn" (click)="deleteDiary(diary._id!)">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </div>
    </div>
  </div>

  <div class="no-entries" *ngIf="filteredDiaries.length === 0"> <!-- // Display message when no entries are found -->
    <p>No diary entries found. Start writing your first entry!</p> <!-- // Text message -->
  </div>
</div>

